{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby-web-push-notifications/","result":{"data":{"site":{"siteMetadata":{"title":"Damola's blog"}},"markdownRemark":{"id":"91867e94-168e-5b56-8aeb-192810880e82","excerpt":"Push notifications are an awesome addition to the web (when they‚Äôre not abused). It lets web apps send notifications to devices as if they‚Äôre natively installed‚Ä¶","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Push notifications are an awesome addition to the web (when they‚Äôre not abused). It lets web apps send notifications to devices as if they‚Äôre natively installed apps! Gatsby on the other hand has turned building static sites into a pretty impressive ecosystem. Bringing push notifications into Gatsby is a natural next step for any modern site. You probably already know all this, if you‚Äôre here reading this and just want to know "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"how"}]},{"type":"text","value":", so I‚Äôll jump right into it."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I went from thinking implementing push notifications in Gatsby would be easy (after all, enabling offline support only took adding a plugin) - to thinking it would be hopelessly difficult, after searching for an offline plugin, not finding one, seeing "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/gatsbyjs/gatsby/issues/11140"},"children":[{"type":"text","value":"this issue"}]},{"type":"text","value":"‚ßâ and thinking I would have to rewrite a new service worker - to realizing it‚Äôs actually doable. All I had to do was "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"append"}]},{"type":"text","value":" to the service-worker that is generated by "},{"type":"element","tagName":"a","properties":{"href":"https://www.gatsbyjs.org/packages/gatsby-plugin-offline/"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gatbsy-plugin-offline"}]}]},{"type":"text","value":"‚ßâ. This was an ‚Äúah-ha‚Äù üí° moment for me."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The option I needed (and missed for a long time) is "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"appendScript"}]},{"type":"text","value":" which points to a javascript file that gets added to the service worker code. So, you can keep the full offline feature the plugin provides and just build on top of that.\nI used this "},{"type":"element","tagName":"a","properties":{"href":"https://developers.google.com/web/fundamentals/push-notifications"},"children":[{"type":"text","value":"guide"}]},{"type":"text","value":"‚ßâ to get a better understanding of implementing push notifications. I highly recommend atleast skimming through that as building out a push notification system involves an end-to-end understanding of the process."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some sections of this post have been edited since original posting.\nThis post is not a step-by-step guide and assumes comfort with a Gatsby; and a project that‚Äôs already set up including plugin(s) referenced. For a full look-through of the code, there‚Äôs a link to this site‚Äôs source at the "},{"type":"element","tagName":"a","properties":{"href":"#references"},"children":[{"type":"text","value":"end of the post"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here is everything I created to get push notifications running,"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A React component that lets users control subscription (the button at the bottom of every page on this blog)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Database for storing subscriptions (add/get/delete)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A Netlify function that listens for subscriptions/unsubscriptions and another for sending push notification to subscribers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Service worker that listens for and sends notifications to the user‚Äôs device."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"push-notification-react-component","style":"position:relative;"},"children":[{"type":"text","value":"Push notification React component"},{"type":"element","tagName":"a","properties":{"href":"#push-notification-react-component","ariaLabel":"push notification react component permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Even though implementing push notifications is (probably equally) a backend and front end endeavor, I ended up spending a lot of time creating this UI component. If you have read my previous posts, you‚Äôll know that I strongly oppose dark patterns (well, I suppose "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"most"}]},{"type":"text","value":" people do). I definitely wanted to do it right, so it was important to make unsubscribing as easy as subscribing - and I took my time to make sure I accomplished this.\nThe component itself is a button that lies in the footer of the page. The basic flow when the button is clicked is:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If the browser supports push notifications: - request permission to send notifications, if permitted: - create a new subscription and send the subscription data to the backend - change the button to allow the user to unsubscribe. - if request not permitted, show an error alert."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"if the browser doesn‚Äôt support push notifications, then nothing shows up."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"On Safari or any other browser that does not support the Push API, the component returns "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"null"}]},{"type":"text","value":" and nothing renders. There‚Äôs one caveat that in Gatsby, ‚Äúwindow‚Äù isn‚Äôt defined at build time (build runs in node) so I had to wrap this check inside another check like so:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"js","theme":"one-dark"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"//PushNotification.js\n...\nif (typeof window !== `undefined`) {\n  if (\"PushManager\" in window) {\n    return true\n  }\n}\n..."}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Subscribing and unsubscribing simply requires making calls to : "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"swRegistration.pushManager.subscribe"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"subscription.unsubscribe"}]},{"type":"text","value":" respectively. Once subscribed, the browser returns a subscription object containing the endpoint url and all extra data required to send encrypted notifications to that url.\nAnd saving the subscription is a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"POST"}]},{"type":"text","value":" call to the subscription endpoint. I will go over that in the section for the Netlify functions."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To persist subscription state (closed tab or even browser), a flag gets stored in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"localStorage"}]},{"type":"text","value":" to specify wether the user is subscribed or not. The value of the flag is used to determine the React state of the subscription button. I used a flag instead of storing subscription information to ensure I was storing the least amount of data (requesting a subscription from the browser returns the same subscription endpoint url if there‚Äôs an existing one, so there‚Äôs no need to store that url)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For notifying on the status of the subscription, I decided to use "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-notify-toast"}]},{"type":"text","value":". It‚Äôs very basic and does exactly what its name suggest. This creates "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"toast notifications"}]},{"type":"text","value":" that show up in the web page itself (so a DOM element), not browser notifications, a bit confusing, I know. It looks something like this:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"media-box","properties":{"src":"media/gatsby-web-push-notifications/toast.gif","name":"Toast notification."},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Update (June-06-2020): After realizing the actual experience of subscribing to push notifications and getting a toast but "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" a push notification is a little jarring, I have now made updates that will send an actual push notification to the user‚Äôs browser to confirm subscription. I‚Äôd avoided this to not annoy people with unnecessary pings, but it definitely fits in this scenario. The toasts described above are "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"still"}]},{"type":"text","value":" shown since I need a way to provide feedback push subscription status even if push is not available."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"database","style":"position:relative;"},"children":[{"type":"text","value":"Database"},{"type":"element","tagName":"a","properties":{"href":"#database","ariaLabel":"database permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are many options for a database for storing subscriptions. I used FaunaDB and it worked out fine. I didn‚Äôt want to keep working with FQL (Fauna‚Äôs query language):\nI just recently migrated to Hasura at "},{"type":"element","tagName":"a","properties":{"href":"https://hasura.io"},"children":[{"type":"text","value":"hasura.io"}]},{"type":"text","value":". This is slightly less straightfoward to set up (hasura is fronting a postgres db running on heroku).\nI do find it easier to work with hasua‚Äôs UI and graphql engine (for me) than FQL."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some options to consider for a database:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"FaunaDB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Hasura + heroku"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Google cloud firestore"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"dynamodb"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Really, any kind of persistent data store that can satisfy the following will suffice:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Storing the subscription data,"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"fetching all subscriptions (when sending notifications)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pulling an individual subscription by its id."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"shape"}]},{"type":"text","value":" (JavaScript object) of the subscriptions is:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"js","theme":"one-dark"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"{\n  endpoint: '<...>',\n  expirationTime: null,\n  keys: {\n    p256dh: '<...>',\n    auth: '<...>'\n  }\n}"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The subscription is stored as-is. This is easy since postgres supports json/jsonb.\nStoring a json string is also valid. This is what I was doing with FaunaDB."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"endpoint"}]},{"type":"text","value":" is always unique for each subscription (per browser); it‚Äôs perfect as the primary key/id.\nA unique ID is necessary for finding and deleting subscriptions when a user unsubscribes. In my case, the table storing subscriptions essentially has two columns - one for the subscription data itself (json) and a column for the endpoint."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"lambda-powered-netlify-functions","style":"position:relative;"},"children":[{"type":"text","value":"(Lambda Powered) Netlify Functions"},{"type":"element","tagName":"a","properties":{"href":"#lambda-powered-netlify-functions","ariaLabel":"lambda powered netlify functions permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I created two Netlify functions ("},{"type":"element","tagName":"a","properties":{"href":"https://github.com/dshomoye/dshomoye.github.io/blob/gatsby/functions/push-subscription.js"},"children":[{"type":"text","value":"push-subscription"}]},{"type":"text","value":"‚ßâ and "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/dshomoye/dshomoye.github.io/blob/gatsby/functions/push-notification.js"},"children":[{"type":"text","value":"push-notification"}]},{"type":"text","value":"‚ßâ\n). Netlify functions are basically AWS Lambda functions so if you have experience with that, it‚Äôs the same. Create an event handler for HTTP requests -> Process the event -> Send a response."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I use a package called "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"graph-request"}]},{"type":"text","value":" for making graphql requests to hasura, same as I did with Fauna.\nSo all I needed was respond to POST and DELETE requests and then sending the appropriate query to the GraphQL endpoint.\nHere is what the handler for creating new subscriptions looks like:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"js","theme":"one-dark"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"//push-subscription.js\n...\nexports.handler = async function(event) {\n  const method = event.httpMethod\n  switch (method) {\n    case \"POST\":\n      try {\n        const eventData = JSON.parse(event.body)\n        const { endpoint, data } = eventData\n        const addResponse = await addSubscription(endpoint, data)\n        console.log(\"New Subscription added for: \", endpoint)\n        return addResponse\n      } catch (error) {\n        console.error(\"Error saving subscription \", error)\n        return {\n          statusCode: 400,\n          body: `{\"error\": \"Unable to process\"}`,\n        }\n      }\n..."}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For sending notifications I created a separate Netlify function "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"push-notification.js"}]},{"type":"text","value":". There is an additional package "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"web-push"}]},{"type":"text","value":" that makes the call to a subscription endpoint (and creates all the necessary encryption using the private key) which then triggers the notification on the user‚Äôs device. This Netlify function runs a GraphQL query to get all subscriptions and sends a web push to each endpoint, the rest of the data required by "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"web-push"}]},{"type":"text","value":" is stored in the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"subscription"}]},{"type":"text","value":" field returned from the database."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"service-worker","style":"position:relative;"},"children":[{"type":"text","value":"Service Worker"},{"type":"element","tagName":"a","properties":{"href":"#service-worker","ariaLabel":"service worker permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Even though the service worker creates the notification that the user sees, it actually turned out to be the simplest piece of this puzzle. I admittedly only implemented creating notifications with a customized "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"title"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":". However, adding support for custom icons, urls (right now, clicking the notification just goes to the homepage of the blog) and adding tags would not be too complicated."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self.addEventListener(‚Äúnotificationclick‚Äù, function(event))"}]},{"type":"text","value":" handles a new notification sent from the backend, this listener is constantly running in the background even when the site is closed.\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"self.registration.showNotification(title, options)"}]},{"type":"text","value":" sends a new notification.\nThe resulting service worker code:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"jsx","theme":"one-dark"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"self.addEventListener(\"push\", (event) => {\n  const notifcationOptions = { title: \"Damola's Blog\" }\n  if (event.data) {\n    notifcationOptions.message = event.data.text()\n    try {\n      const notificationData = event.data.json()\n      notifcationOptions.title = notificationData.title\n      notifcationOptions.message = notificationData.message\n    } catch (error) {\n      console.error(\"Error processing notification data\", error)\n    }\n  }\n  event.waitUntil(\n    self.registration.showNotification(notifcationOptions.title, {\n      body: notifcationOptions.message\n        ? notifcationOptions.message\n        : \"Site Update\",\n    })\n  )\n})\n\nself.addEventListener(\"notificationclick\", (event) => {\n  event.notification.close()\n  const url = \"https://dshomoye.dev\"\n  clients.openWindow(url)\n})"}]},{"type":"text","value":"\n        "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And then I updated "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gatsby-config"}]},{"type":"text","value":" to include the custom service worker code, like so:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"js","theme":"one-dark"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"//gatsby-config.js\n...\n    {\n      resolve: `gatsby-plugin-offline`,\n      options: {\n        appendScript: require.resolve(`${__dirname}/src/notification-sw.js`),\n      },\n    },\n..."}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And that‚Äôs it!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I send notifications using Postman right now. I considered building out a UI to call the Netlify function I created, but I only need to send a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"title"}]},{"type":"text","value":" and a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":", it was too much effort for too little gain."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"references","style":"position:relative;"},"children":[{"type":"text","value":"References"},{"type":"element","tagName":"a","properties":{"href":"#references","ariaLabel":"references permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here are some links that will should hopefully help with getting started and might have been missed in the article:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Web Push Notifications "},{"type":"element","tagName":"a","properties":{"href":"https://developers.google.com/web/fundamentals/push-notifications"},"children":[{"type":"text","value":"tutorial"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.gatsbyjs.org/packages/gatsby-plugin-offline/"},"children":[{"type":"text","value":"Offline plugin for Gatsby"}]},{"type":"text","value":" - this plugin is not required but adding offline capability is very beneficial, the plugin also automatically sets up the service worker."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.npmjs.com/package/web-push"},"children":[{"type":"text","value":"web-push"}]},{"type":"text","value":" npm package."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Code is public, you can view the full source "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/dshomoye/dshomoye.github.io"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":" - and feel free to star/follow or drop a note."}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"frontmatter":{"title":"Web Push Notifications in Gatsby.","date":"March 15, 2020","description":"How I added notifications to this Gatsby blog using service workers and Netlify functions.","gallerySources":null,"lastUpdated":"March 10, 2021","tags":["technology"]},"timeToRead":8}},"pageContext":{"slug":"/gatsby-web-push-notifications/","previous":{"parent":{"name":"index"},"fields":{"slug":"/stay-safe-online/"},"frontmatter":{"title":"A millenial's guide to staying safe online."}},"next":{"parent":{"name":"index"},"fields":{"slug":"/observables-hard-easy/"},"frontmatter":{"title":"Learning Observables the hard (easy) way"}}}},"staticQueryHashes":["139983731","63159454"]}